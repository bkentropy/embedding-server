[workspace]
name = "embedding-server"
version = "1.0.0"
description = "A FastAPI-based service for generating text embeddings using Sentence Transformers"
channels = ["conda-forge"]
platforms = ["linux-64", "osx-arm64"]

[tasks]
start = "uvicorn main:app --host 0.0.0.0 --port 8111"
dev = "uvicorn main:app --host 0.0.0.0 --port 8111 --reload"

[dependencies]
python = ">=3.10,<3.12"

[pypi-dependencies]
fastapi = "==0.110.0"
uvicorn = "==0.29.0"
python-multipart = "==0.0.9"
numpy = "<2"
transformers = "==4.41.0"
sentence-transformers = { version = "==5.2.2", extras = ["onnx"] }
pydantic = "==1.10.13"

[pypi-options]
extra-index-urls = ["https://download.pytorch.org/whl/cpu"]

# macOS uses regular torch (no CPU-specific build needed)
[target.osx-arm64.pypi-dependencies]
torch = "==2.6.0"

# Linux uses CPU-optimized torch
[target.linux-64.pypi-dependencies]
torch = "==2.6.0+cpu"
